{"html":"<!-- TITLE: Ambiente Staging --><!-- SUBTITLE: Como utilizar um link para visualizar mudanças que ainda irão ao ar --><html><head></head><body><p>O ambiente Staging nada mais &#xE9; do que uma c&#xF3;pia quase perfeita do Aut&#xF3;dromo real. A grande diferen&#xE7;a &#xE9; que algumas configura&#xE7;&#xF5;es s&#xE3;o modificadas para possibilitar o teste de novas funcionalidades, sem que isso interfira no funcionamento normal da plataforma. O Aut&#xF3;dromo conta com 4 tipos de ambientes:</p>\n<ul>\n<li><strong>Test</strong>: Aqui &#xE9; onde os <strong>testes automatizados</strong> s&#xE3;o rodados, geralmente cont&#xE9;m apenas o necess&#xE1;rio para a aplica&#xE7;&#xE3;o rodar. O c&#xF3;digo nesse ambiente pode ser altamente experimental, e &#xE9; usado para checar o funcionamento das features sem a necessidade de usar a aplica&#xE7;&#xE3;o real.</li>\n<li><strong>Development</strong>: Esse ambiente tem configura&#xE7;&#xF5;es pr&#xF3;prias, podendo ter diferen&#xE7;as consider&#xE1;veis com o que est&#xE1; no ar. Se assemelha bastante ao ambiente Test, mas &#xE9; mais palp&#xE1;vel para facilitar o trabalho do <strong>time de desenvolvimento</strong></li>\n<li><strong>Staging</strong>: Aqui &#xE9; onde se tem o c&#xF3;digo a ser testado. As configura&#xE7;&#xF5;es deste ambiente se assemelham ao m&#xE1;ximo com o Aut&#xF3;dromo real, isso acontece pois precisamos <strong>prever o comportamento de novas funcionalidades antes de elas irem ao ar</strong>.</li>\n<li><strong>Production</strong>: Esse &#xE9; o Aut&#xF3;dromo como n&#xF3;s conhecemos. Aqui o <strong>c&#xF3;digo j&#xE1; foi testado e aprovado</strong> nos outros 3 ambientes e nossa equipe de suporte far&#xE1; os tutoriais de nossa plataforma.</li>\n</ul>\n<hr>\n<p>Para fazer uso do ambiente Staging ao m&#xE1;ximo, o ideal &#xE9; que se use uma aplica&#xE7;&#xE3;o no Heroku para isso. Isso &#xE9; necess&#xE1;rio para identificar problemas que n&#xE3;o aconteceriam caso fosse usada a sua pr&#xF3;pria m&#xE1;quina na viasualiza&#xE7;&#xE3;o de novas funcionalidades. O nosso projeto no GitHub j&#xE1; inicializa essas aplica&#xE7;&#xF5;es automaticamente, sendo necess&#xE1;rio apenas alguns passos para disponibilizar um link tempor&#xE1;rio para testes.</p>\n<ol>\n<li>\n<p>A <strong>equipe de desenvolvimento</strong> realiza a <a href=\"https://help.github.com/articles/about-pull-requests/\" class=\"external-link\">cria&#xE7;&#xE3;o de um pull request</a>, que &#xE9; um grupo de mudan&#xE7;as no c&#xF3;digo que fazem parte de uma ou um conjunto de tarefas<br>\n<img src=\"/uploads/uploads/pull-request.png\" alt=\"Pull Request\" title=\"Pull Request\"></p>\n</li>\n<li>\n<p>No <strong>Heroku</strong>, ap&#xF3;s o passo 1, &#xE9; necess&#xE1;rio ativar o <em>review app</em> clicando em <strong>Create Review App</strong> no pull request aberto no passo 1. Isso ir&#xE1; criar um link tempor&#xE1;rio permitindo que as pessoas acessem as mudan&#xE7;as realizadas com o formato: <code>autodromo-teste-pr-(numero do pull request).herokuapp.com</code><br>\n<img src=\"/uploads/uploads/create-review-app.png\" alt=\"Create Review App\" title=\"Create Review App\"></p>\n</li>\n<li>\n<p>Agora, para visualizar as altera&#xE7;&#xF5;es em algum canal espec&#xED;fico, se faz necess&#xE1;ria a cria&#xE7;&#xE3;o um apontamento de dom&#xED;nio ou subdom&#xED;nio, as op&#xE7;&#xF5;es s&#xE3;o:</p>\n<ul>\n<li><a href=\"/uploads/dominio-interno.sh\" title=\"Dominio Interno\" class=\"internal-link\">Modificar o seu <strong>arquivo hosts</strong></a>, apontando para o IP do link tempor&#xE1;rio algum endere&#xE7;o. <strong>Vantagem:</strong> R&#xE1;pido. <strong>Desvantagem:</strong> Funciona apenas localmente.</li>\n<li>Modificar entradas de DNS do dom&#xED;nio <strong><a href=\"http://voltadeapresentacao.com.br\" class=\"external-link\">voltadeapresentacao.com.br</a></strong>, <a href=\"https://community.cloudflare.com/t/how-do-i-add-a-cname-record/59\" class=\"external-link\">apontando algum CNAME</a> para o link tempor&#xE1;rio. <strong>Vantagem:</strong> Funciona mudialmente. <strong>Desvantagem:</strong> Demora na propaga&#xE7;&#xE3;o.</li>\n</ul>\n</li>\n<li>\n<p>Entrar na aplica&#xE7;&#xE3;o criada no passo 2 e adicionar o dom&#xED;nio utilizado no passo 3 em <strong>Settings &gt; Domains and certificates &gt; Add Domain</strong><br>\n<img src=\"/uploads/uploads/dominios-heroku.png\" alt=\"Dominios Heroku\" title=\"Dominios Heroku\"></p>\n</li>\n<li>\n<p>Para ter acesso ao login usado normalmente no Aut&#xF3;dromo e conseguir puxar um estado dos sites que copie o da aplica&#xE7;&#xE3;o real &#xE9; necess&#xE1;rio copiar o banco de dados para a aplica&#xE7;&#xE3;o de testes. Para isso &#xE9; necess&#xE1;rio rodar um comando do Heroku em sua m&#xE1;quina, logando em uma conta que tenha acesso a ambas as aplica&#xE7;&#xF5;es:</p>\n</li>\n</ol>\n<pre><code>$ heroku pg:copy autodromo::DATABASE_URL DATABASE_URL --app autodromo-teste-pr-(numero do pull request)\n</code></pre>\n<ul>\n<li>Esse passo deve ser repetido sempre que o pull request sofrer mudan&#xE7;as, pois o banco reseta no processo de deploy da aplica&#xE7;&#xE3;o.</li>\n<li>Caso a altera&#xE7;&#xE3;o contenha uma migra&#xE7;&#xE3;o no estado do banco de dados, ap&#xF3;s rodar esse comando &#xE9; necess&#xE1;rio rodar tamb&#xE9;m:</li>\n</ul>\n<pre><code>$ heroku run rake db:migrate --app autodromo-teste-pr-(numero do pull request)\n</code></pre>\n<ol start=\"6\">\n<li><strong>(Opicional)</strong> Entre no administrativo atrav&#xE9;s do link configurado e edite um site para utilizar como dom&#xED;nio um endere&#xE7;o apontado no passo 3</li>\n</ol>\n<p>Ap&#xF3;s isso, ao acessar o endere&#xE7;o configurado a aplica&#xE7;&#xE3;o estar&#xE1; dispon&#xED;vel normalmente, lembrando que mudan&#xE7;as afetando esse endere&#xE7;o n&#xE3;o afetam o Aut&#xF3;dromo e mudan&#xE7;as no Aut&#xF3;dromo n&#xE3;o afetam esse endere&#xE7;o. Essa caracter&#xED;stica do ambiente Staging faz com que voc&#xEA; possa testar casos extremos de configura&#xE7;&#xE3;o, ent&#xE3;o pode mudar a vontade os par&#xE2;metros do sistema sem medo de quebrar nada nos sites reais. Em casos de detec&#xE7;&#xE3;o de bugs, comportamentos inesperados, ou se voc&#xEA; encontrar uma p&#xE1;gina de erro: <strong>n&#xE3;o deixe de report&#xE1;-lo para a equipe de suporte</strong>. Desse jeito voc&#xEA; estar&#xE1; contribuindo para o desenvolvimento de uma plataforma est&#xE1;vel e alinhada com as necessidades dos usu&#xE1;rios.</p>\n<blockquote>\n<p>Lembre-se de indicar nas convers&#xF5;es realizadas no ambiente Staging de que elas n&#xE3;o s&#xE3;o reais, pois os fluxos de integra&#xE7;&#xE3;o e envio de alertas funcionam normalmente. <strong>Pense nas equipes de vendas que receber&#xE3;o os alertas desses leads!</strong></p>\n</blockquote>\n<hr>\n<h1 id=\"troubleshooting\"><a class=\"toc-anchor nc-icon-outline location_bookmark-add internal-link\" href=\"#troubleshooting\" aria-hidden=\"true\"></a> Troubleshooting</h1>\n<h2 id=\"abri-o-link-mas-deu-erro-no-navegador\"><a class=\"toc-anchor nc-icon-outline location_bookmark-add internal-link\" href=\"#abri-o-link-mas-deu-erro-no-navegador\" aria-hidden=\"true\"></a> Abri o link, mas deu erro no navegador</h2><div class=\"indent-h2\"><p><img src=\"/uploads/uploads/dns.png\" alt=\"Dns\" title=\"Dns\"></p><p>Quando isso acontece significa que o seu computador <strong>n&#xE3;o conseguiu se conectar ao endere&#xE7;o de testes</strong>. Isso pode significar alguma das seguintes op&#xE7;&#xF5;es:</p><ol>\n<li>Apontamento feito para um IP ou endere&#xE7;o inv&#xE1;lido</li>\n<li>Apontamento feito para um IP que mudou, ou remanescente de uma configura&#xE7;&#xE3;o anterior</li>\n<li>M&#xE1; configura&#xE7;&#xE3;o no DNS ou no arquivo hosts</li>\n<li>O DNS ainda n&#xE3;o propagou para a sua &#xE1;rea de acesso</li>\n<li>Voc&#xEA; precisa <a href=\"https://www.keycdn.com/support/dns-cache/\" class=\"external-link\">expirar o cache de DNS</a> de sua m&#xE1;quina</li>\n</ol><p>Caso voc&#xEA; n&#xE3;o consiga realizar o apontamento DNS ou a execu&#xE7;&#xE3;o do script de edi&#xE7;&#xE3;o de arquivo hosts, entre em contato com a equipe de PitStop.</p></div>\n\n\n\n\n<h2 id=\"apareceu-um-erro-do-heroku\"><a class=\"toc-anchor nc-icon-outline location_bookmark-add internal-link\" href=\"#apareceu-um-erro-do-heroku\" aria-hidden=\"true\"></a> Apareceu um erro do Heroku</h2><div class=\"indent-h2\"><p>\n<img src=\"/uploads/uploads/heroku-nosuchapp.png\" alt=\"Heroku no such app\" width=\"300\">\n</p><p>Seu apontamento DNS foi feito com sucesso, mas voc&#xEA; n&#xE3;o adicionou o dom&#xED;nio ou o subdom&#xED;nio &#xE0; aplica&#xE7;&#xE3;o de testes no Heroku. Volte ao tutorial no inicio dessa p&#xE1;gina e refa&#xE7;a o <strong>passo 4</strong>. Caso voc&#xEA; n&#xE3;o consiga realizar o cadastro do endere&#xE7;o, entre em contato com a equipe de PitStop.</p></div>\n\n\n<h2 id=\"apareceu-o-site-da-auto-force-ou-deu-um-erro-404-mas-era-pra-ser-um-site-especifico\"><a class=\"toc-anchor nc-icon-outline location_bookmark-add internal-link\" href=\"#apareceu-o-site-da-auto-force-ou-deu-um-erro-404-mas-era-pra-ser-um-site-especifico\" aria-hidden=\"true\"></a> Apareceu o site da AutoForce ou deu um erro 404, mas era pra ser um site espec&#xED;fico</h2><div class=\"indent-h2\"><p>\n<img src=\"/uploads/uploads/404.png\" alt=\"404\" width=\"300\">\n</p><p>Parab&#xE9;ns, voc&#xEA; conseguiu configurar o ambiente de Staging corretamente, faltou apenas <strong>configurar o canal que voc&#xEA; deseja visualizar</strong>. Acesse a interface administrativa do Aut&#xF3;dromo e edite o dom&#xED;nio do canal alvo. Ap&#xF3;s isso, acesse novamente o endere&#xE7;o, caso aconte&#xE7;a novamente, entre em contato com a equipe de PitStop.</p></div>\n\n\n<h2 id=\"nao-consigo-logar-em-uma-conta-que-tenho-certeza-que-existe\"><a class=\"toc-anchor nc-icon-outline location_bookmark-add internal-link\" href=\"#nao-consigo-logar-em-uma-conta-que-tenho-certeza-que-existe\" aria-hidden=\"true\"></a> N&#xE3;o consigo logar em uma conta que tenho certeza que existe</h2><div class=\"indent-h2\"><p>\n<img src=\"/uploads/uploads/nao-consigo-logar.png\" alt=\"N&#xE3;o consigo logar\" width=\"300\">\n</p><p>Algo de errado aconteceu ao clonar o banco de dados do Aut&#xF3;dromo, talvez algo de errado tenha acontecido ao executar o <strong>passo 5</strong>. Isso pode acontecer tamb&#xE9;m nos casos que a equipe de desenvolvimento tenha atualizado o c&#xF3;digo na aplica&#xE7;&#xE3;o e n&#xE3;o tenha conclu&#xED;do o processo de c&#xF3;pia do banco de dados. Caso voc&#xEA; n&#xE3;o consiga realizar a execu&#xE7;&#xE3;o do comando, entre em contato com a equipe de PitStop.</p></div>\n\n\n</body></html>","meta":{"title":"Ambiente Staging","subtitle":"Como utilizar um link para visualizar mudanças que ainda irão ao ar","path":"staging"},"tree":[{"content":"Troubleshooting","anchor":"troubleshooting","nodes":[{"content":"Abri o link, mas deu erro no navegador","anchor":"abri-o-link-mas-deu-erro-no-navegador","nodes":[]},{"content":"Apareceu um erro do Heroku","anchor":"apareceu-um-erro-do-heroku","nodes":[]},{"content":"Apareceu o site da AutoForce ou deu um erro 404, mas era pra ser um site específico","anchor":"apareceu-o-site-da-auto-force-ou-deu-um-erro-404-mas-era-pra-ser-um-site-especifico","nodes":[]},{"content":"Não consigo logar em uma conta que tenho certeza que existe","anchor":"nao-consigo-logar-em-uma-conta-que-tenho-certeza-que-existe","nodes":[]}]}],"parent":false}